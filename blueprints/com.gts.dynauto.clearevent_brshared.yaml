name: "com.gts.dynauto.clearevent_brshared"
enabled: true
config: &baseconfig
  db2uri: "jdbc:db2://myhost:5021/mydb"
  db2user: dynauto
  db2pass: pass
starter:
  method: polling
  every: "5 seconds"
  proc: "ninja.miki.db2.query"
  params: 
    <<: *baseconfig
    query: "select w.recordkey, t.ticketuid 
from maximo.worklog w 
inner join maximo.ticket t on w.recordkey = t.ticketid 
inner join maximo.ci ci on t.cinum = ci.cinum and ci.ITDCIMANAGEDBY = 'IBM' 
where w.description like ? 
and t.status not in ('RESOLVED','CLOSED','CANCELLED','HISTEDIT','SLAHOLD') 
and t.ADJUSTEDTARGETRESOLUTIONTIME > current timestamp 
and t.ownergroup not like '%P20K%' 
and t.description not like '%TWS%Job%' 
and t.internalpriority <> 1
and w.modifydate < current timestamp - 10 minutes 
AND (SELECT count(1) FROM  maximo.ticket ct WHERE ct.STATUS='RESOLVED' AND ct.ACTUALFINISH > (w.createdate - 6 HOURS) AND ct.OWNERGROUP = ? AND ct.PLUSPCUSTOMER=t.PLUSPCUSTOMER AND ct.TARGETDESC=t.TARGETDESC) < ?
group by w.recordkey, t.ticketuid"
steps: 
  - break-array
  - proc: "ninja.miki.facebook.fetch_timeline"
    params: 
      bulk?: yes 
      threshold-property: "last_updated"
      fbobject-property: "id"
      fields: [caption,created_time,from,full_picture,id,link,message,message_tags,name,status_type,type,updated_time]
      page-limit: 100
      authentication:
        type: "credentials"
        fetch-from: "data"
        client-id-property: "account.client-id"
        client-secret-property: "account.client-secret"


